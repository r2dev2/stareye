{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "App.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { onMount } from 'svelte';\n  import { runningStats } from './stats.js';\n  import { pixelReduce } from './store.js';\n\n  const windowSize = 300;\n  const pollIntervalMs = 10;\n\n  // statistics on sum of pixel values\n  const stats = runningStats(windowSize);\n\n  // statistics on z-score of pixel value sums\n  //\n  // We need to take the z-score of a z-score because\n  // different cameras have different noises and resolutions.\n  //\n  // If we hard-coded a bang as all |z-score| above a ridiculously\n  // high 50 for one camera, it won't work for other cameras.\n  //\n  // However, by taking the z-score of z-scores, we've essentially\n  // normalized the noise and can use a reasonable |z| >= 3 that\n  // should work for all cameras.\n  //\n  // It is worth noting that during calibration, a low pass filter\n  // over pixelSum might have also worked for reducing noise.\n  const zstats = runningStats(windowSize);\n\n  let ready = false;\n  let bang = null;\n  let now = Date.now();\n\n  /** @type {() => number} */\n  const getPixelSum = () =>\n    $pixelReduce((acc, color) => {\n      return acc + color[0] + color[1] + color[2];\n    }, 0);\n\n  const clear = () => {\n    stats.clear();\n    zstats.clear();\n    bang = null;\n  };\n\n  onMount(() => {\n    const interval = setInterval(() => {\n      const pixelSum = getPixelSum();\n      const { mean, std } = $stats;\n      const { mean: zmean, std: zstd } = $zstats;\n\n      const zscore = pixelSum - mean;\n      const zzscore = Math.ceil(Math.abs((zscore - zmean) / (zstd + 10)));\n\n      ready = stats.ready();\n      now = Date.now();\n\n      if (stats.ready()) {\n        if (bang === null && Math.abs(zzscore) > 2) {\n          console.log('BANG', zzscore, Date.now());\n          bang = Date.now();\n        }\n      }\n      // calibrate still frame statistics during calibration period\n      // pixelSum > 0 will be true when the video has loaded\n      else if (pixelSum > 0) {\n        stats.addData(pixelSum);\n        zstats.addData(zscore);\n      }\n    }, pollIntervalMs);\n\n    return () => {\n      clearInterval(interval);\n      clear();\n    };\n  });\n</script>\n\n<main>\n  <div\n    class=\"stats\"\n    class:waiting={ready && bang === null}\n    class:ready={ready && bang !== null}\n  >\n    <button on:click={clear}> Reset Stats </button>\n\n    {#if !ready}\n      <p>Calibrating...</p>\n    {:else if bang === null}\n      <p>Waiting for movement...</p>\n    {:else}\n      <p>BANG! {Math.floor((now - bang) / 1000)}s</p>\n    {/if}\n  </div>\n</main>\n\n<style>\n  :global(body) {\n    overflow: hidden;\n    padding: 0px !important;\n    background-color: black;\n  }\n\n  :global(video) {\n    position: fixed;\n    top: 0;\n    left: 50%;\n    height: 100vh;\n    width: 100vw;\n    object-fit: fill;\n    z-index: 1;\n    transform: translateX(-50%);\n  }\n\n  main {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 2;\n    padding: 3rem;\n  }\n\n  .stats {\n    --stats-border-color: red;\n    padding: 2rem;\n    background-color: white;\n    height: 10rem;\n    width: 20rem;\n    box-sizing: border-box;\n    border: 1rem solid var(--stats-border-color);\n    transition: 200ms ease-out;\n  }\n\n  .waiting {\n    --stats-border-color: goldenrod;\n  }\n\n  .ready {\n    --stats-border-color: lightgreen;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "AA+FU,IAAI,AAAE,CAAC,AACb,QAAQ,CAAE,MAAM,CAChB,OAAO,CAAE,GAAG,CAAC,UAAU,CACvB,gBAAgB,CAAE,KAAK,AACzB,CAAC,AAEO,KAAK,AAAE,CAAC,AACd,QAAQ,CAAE,KAAK,CACf,GAAG,CAAE,CAAC,CACN,IAAI,CAAE,GAAG,CACT,MAAM,CAAE,KAAK,CACb,KAAK,CAAE,KAAK,CACZ,UAAU,CAAE,IAAI,CAChB,OAAO,CAAE,CAAC,CACV,SAAS,CAAE,WAAW,IAAI,CAAC,AAC7B,CAAC,AAED,IAAI,eAAC,CAAC,AACJ,QAAQ,CAAE,QAAQ,CAClB,GAAG,CAAE,CAAC,CACN,IAAI,CAAE,CAAC,CACP,KAAK,CAAE,KAAK,CACZ,MAAM,CAAE,KAAK,CACb,OAAO,CAAE,CAAC,CACV,OAAO,CAAE,IAAI,AACf,CAAC,AAED,MAAM,eAAC,CAAC,AACN,oBAAoB,CAAE,GAAG,CACzB,OAAO,CAAE,IAAI,CACb,gBAAgB,CAAE,KAAK,CACvB,MAAM,CAAE,KAAK,CACb,KAAK,CAAE,KAAK,CACZ,UAAU,CAAE,UAAU,CACtB,MAAM,CAAE,IAAI,CAAC,KAAK,CAAC,IAAI,oBAAoB,CAAC,CAC5C,UAAU,CAAE,KAAK,CAAC,QAAQ,AAC5B,CAAC,AAED,QAAQ,eAAC,CAAC,AACR,oBAAoB,CAAE,SAAS,AACjC,CAAC,AAED,MAAM,eAAC,CAAC,AACN,oBAAoB,CAAE,UAAU,AAClC,CAAC"
}