{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "App.svelte",
    "JoinInfo.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { onMount } from 'svelte';\n  import * as Network from './network.js';\n  import { runningStats } from './stats.js';\n  import { id, devices, showJoinInfo, pixelReduce } from './store.js';\n  import JoinInfo from './JoinInfo.svelte';\n\n  const windowSize = 100;\n  const pollIntervalMs = 10;\n  const preCalPeriod = 3000;\n\n  // statistics on sum of pixel values\n  const stats = runningStats(windowSize);\n\n  // statistics on z-score of pixel value sums\n  //\n  // We need to take the z-score of a z-score because\n  // different cameras have different noises and resolutions.\n  //\n  // If we hard-coded a bang as all |z-score| above a ridiculously\n  // high 50 for one camera, it won't work for other cameras.\n  //\n  // However, by taking the z-score of z-scores, we've essentially\n  // normalized the noise and can use a reasonable |z| >= 3 that\n  // should work for all cameras.\n  //\n  // It is worth noting that during calibration, a low pass filter\n  // over pixelSum might have also worked for reducing noise.\n  const zstats = runningStats(windowSize);\n\n  let ready = false;\n  /** @type {number | null} */\n  let bang = null;\n  let calibrationStart = Date.now();\n  let now = Date.now();\n\n  /** @type {() => number} */\n  const getPixelSum = () =>\n    $pixelReduce((acc, color) => {\n      return acc + color[0] + color[1] + color[2];\n    }, 0);\n\n  const clear = () => {\n    stats.clear();\n    zstats.clear();\n    bang = null;\n    calibrationStart = Date.now();\n  };\n\n  onMount(() => {\n    const interval = setInterval(() => {\n      const pixelSum = getPixelSum();\n      const { mean } = $stats;\n      const { mean: zmean, std: zstd } = $zstats;\n\n      const zscore = pixelSum - mean;\n      const zzscore = Math.ceil(Math.abs((zscore - zmean) / (zstd + 10)));\n\n      ready = stats.ready();\n      now = Date.now();\n\n      if (stats.ready()) {\n        if (bang === null && Math.abs(zzscore) > 2) {\n          console.log('BANG', zzscore, Date.now());\n          bang = Date.now();\n        }\n      }\n      // calibrate still frame statistics during calibration period\n      // pixelSum > 0 will be true when the video has loaded\n      else if (pixelSum > 0 && now - calibrationStart > preCalPeriod) {\n        stats.addData(pixelSum);\n        zstats.addData(zscore);\n      }\n    }, pollIntervalMs);\n\n    return () => {\n      clearInterval(interval);\n      clear();\n    };\n  });\n\n  onMount(() => {\n    Network.setup();\n    return () => Network.cleanup();\n  });\n</script>\n\n<main>\n  {#if $id !== null && $showJoinInfo}\n    <JoinInfo id={$id} on:close={() => showJoinInfo.set(false)} />\n  {/if}\n  <div\n    class=\"stats\"\n    class:waiting={ready && bang === null}\n    class:ready={ready && bang !== null}\n  >\n    <div class=\"controls\">\n      {#if $devices.length === 0}\n        <button on:click={() => showJoinInfo.set(true)}>Connect Device</button>\n      {:else}\n        <button disabled>Device Paired</button>\n      {/if}\n      <button on:click={clear}> Reset Stats </button>\n    </div>\n\n    {#if !ready}\n      <p>Calibrating...</p>\n    {:else if bang === null}\n      <p>Waiting for movement...</p>\n    {:else}\n      <p>BANG! {Math.floor((now - bang) / 1000)}s</p>\n    {/if}\n  </div>\n</main>\n\n<style>\n  :global(body) {\n    padding: 0px !important;\n    background-color: black;\n  }\n\n  :global(video) {\n    position: fixed;\n    top: 0;\n    left: 50%;\n    height: 100vh;\n    width: 100vw;\n    object-fit: fill;\n    z-index: 1;\n    transform: translateX(-50%);\n  }\n\n  main {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 2;\n    padding: 3rem;\n  }\n\n  .stats {\n    --stats-border-color: red;\n    padding: 2rem;\n    background-color: white;\n    height: 10rem;\n    width: 20rem;\n    box-sizing: border-box;\n    border: 1rem solid var(--stats-border-color);\n    transition: 200ms ease-out;\n  }\n\n  .waiting {\n    --stats-border-color: goldenrod;\n  }\n\n  .ready {\n    --stats-border-color: lightgreen;\n  }\n\n  .controls {\n    display: flex;\n    flex-direction: row;\n  }\n</style>\n",
    "<script>\n  import { createEventDispatcher } from 'svelte';\n  import QrCode from './QrCode.svelte';\n\n  export let id = '';\n\n  const dispatch = createEventDispatcher();\n\n  /** @type {(id: string) => string} */\n  const getJoinLink = (id) => {\n    const url = new URL(window.location.href);\n    url.searchParams.set('id', id);\n    return url.toString();\n  };\n\n  $: joinLink = getJoinLink(id);\n</script>\n\n<div class=\"join-info-scrim\" on:click={() => dispatch('close')}>\n  <button class=\"close-button\">&times;</button>\n  <div class=\"join-info\" on:click|stopPropagation>\n    <p><a href={joinLink}>{joinLink}</a></p>\n    <QrCode\n      value={joinLink}\n      size={Math.min(window.innerWidth, window.innerHeight) * 0.8}\n      padding={0}\n    />\n  </div>\n</div>\n\n<style>\n  .join-info-scrim {\n    --scrim-opacity: 0.5;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    z-index: 99;\n    background-color: rgba(0, 0, 0, var(--scrim-opacity));\n  }\n\n  .join-info {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background-color: white;\n    padding: 0.25rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .close-button {\n    position: absolute;\n    top: 1rem;\n    right: 1rem;\n    font-size: 1.5rem;\n    padding: 0rem 0.5rem;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "AAoHU,IAAI,AAAE,CAAC,AACb,OAAO,CAAE,GAAG,CAAC,UAAU,CACvB,gBAAgB,CAAE,KAAK,AACzB,CAAC,AAEO,KAAK,AAAE,CAAC,AACd,QAAQ,CAAE,KAAK,CACf,GAAG,CAAE,CAAC,CACN,IAAI,CAAE,GAAG,CACT,MAAM,CAAE,KAAK,CACb,KAAK,CAAE,KAAK,CACZ,UAAU,CAAE,IAAI,CAChB,OAAO,CAAE,CAAC,CACV,SAAS,CAAE,WAAW,IAAI,CAAC,AAC7B,CAAC,AAED,IAAI,cAAC,CAAC,AACJ,QAAQ,CAAE,QAAQ,CAClB,GAAG,CAAE,CAAC,CACN,IAAI,CAAE,CAAC,CACP,KAAK,CAAE,KAAK,CACZ,MAAM,CAAE,KAAK,CACb,OAAO,CAAE,CAAC,CACV,OAAO,CAAE,IAAI,AACf,CAAC,AAED,MAAM,cAAC,CAAC,AACN,oBAAoB,CAAE,GAAG,CACzB,OAAO,CAAE,IAAI,CACb,gBAAgB,CAAE,KAAK,CACvB,MAAM,CAAE,KAAK,CACb,KAAK,CAAE,KAAK,CACZ,UAAU,CAAE,UAAU,CACtB,MAAM,CAAE,IAAI,CAAC,KAAK,CAAC,IAAI,oBAAoB,CAAC,CAC5C,UAAU,CAAE,KAAK,CAAC,QAAQ,AAC5B,CAAC,AAED,QAAQ,cAAC,CAAC,AACR,oBAAoB,CAAE,SAAS,AACjC,CAAC,AAED,MAAM,cAAC,CAAC,AACN,oBAAoB,CAAE,UAAU,AAClC,CAAC,AAED,SAAS,cAAC,CAAC,AACT,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,GAAG,AACrB,CAAC;ACrID,gBAAgB,aAAC,CAAC,AAChB,eAAe,CAAE,GAAG,CACpB,QAAQ,CAAE,KAAK,CACf,GAAG,CAAE,CAAC,CACN,IAAI,CAAE,CAAC,CACP,KAAK,CAAE,KAAK,CACZ,MAAM,CAAE,KAAK,CACb,OAAO,CAAE,EAAE,CACX,gBAAgB,CAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,eAAe,CAAC,CAAC,AACvD,CAAC,AAED,UAAU,aAAC,CAAC,AACV,QAAQ,CAAE,QAAQ,CAClB,GAAG,CAAE,GAAG,CACR,IAAI,CAAE,GAAG,CACT,SAAS,CAAE,UAAU,IAAI,CAAC,CAAC,IAAI,CAAC,CAChC,gBAAgB,CAAE,KAAK,CACvB,OAAO,CAAE,OAAO,CAChB,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,WAAW,CAAE,MAAM,AACrB,CAAC,AAED,aAAa,aAAC,CAAC,AACb,QAAQ,CAAE,QAAQ,CAClB,GAAG,CAAE,IAAI,CACT,KAAK,CAAE,IAAI,CACX,SAAS,CAAE,MAAM,CACjB,OAAO,CAAE,IAAI,CAAC,MAAM,AACtB,CAAC"
}