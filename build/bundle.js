var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function s(t,e,n){t.$$.on_destroy.push(i(e,n))}function u(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function d(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function p(){return f(" ")}function h(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function $(t,e,n){t.classList[n?"add":"remove"](e)}let v;function b(t){v=t}function w(){if(!v)throw new Error("Function called outside component initialization");return v}function y(t){w().$$.on_mount.push(t)}function x(){const t=w();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const c=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,o,e),r}(e,n,{cancelable:o});return r.slice().forEach((e=>{e.call(t,c)})),!c.defaultPrevented}return!0}}function _(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const E=[],k=[],C=[],D=[],M=Promise.resolve();let A=!1;function z(t){C.push(t)}const P=new Set;let S=0;function j(){const t=v;do{for(;S<E.length;){const t=E[S];S++,b(t),I(t.$$)}for(b(null),E.length=0,S=0;k.length;)k.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];P.has(e)||(P.add(e),e())}C.length=0}while(E.length);for(;D.length;)D.pop()();A=!1,P.clear(),b(t)}function I(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(z)}}const L=new Set;let R;function N(t,e){t&&t.i&&(L.delete(t),t.i(e))}function O(t,e,n,o){if(t&&t.o){if(L.has(t))return;L.add(t),R.c.push((()=>{L.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function W(t){t&&t.c()}function q(t,n,c,i){const{fragment:s,on_mount:u,on_destroy:l,after_update:a}=t.$$;s&&s.m(n,c),i||z((()=>{const n=u.map(e).filter(r);l?l.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(z)}function H(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function B(t,e){-1===t.$$.dirty[0]&&(E.push(t),A||(A=!0,M.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Q(e,r,c,i,s,u,l,d=[-1]){const f=v;b(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(f?f.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:r.target||f.$$.root};l&&l(p.root);let h=!1;if(p.ctx=c?c(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return p.ctx&&s(p.ctx[t],p.ctx[t]=r)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](r),h&&B(e,t)),n})):[],p.update(),h=!0,o(p.before_update),p.fragment=!!i&&i(p.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();r.intro&&N(e.$$.fragment),q(e,r.target,r.anchor,r.customElement),j()}b(f)}class U{$destroy(){H(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const G=null!==new URLSearchParams(window.location.search).get("nocam"),T={Peer:window.Peer,QRious:window.QRious},F=[];function J(t,e){return{subscribe:K(t,e).subscribe}}function K(e,n=t){let o;const r=new Set;function i(t){if(c(e,t)&&(e=t,o)){const t=!F.length;for(const t of r)t[1](),F.push(t,e);if(t){for(let t=0;t<F.length;t+=2)F[t][0](F[t+1]);F.length=0}}}return{set:i,update:function(t){i(t(e))},subscribe:function(c,s=t){const u=[c,s];return r.add(u),1===r.size&&(o=n(i)||t),c(e),()=>{r.delete(u),0===r.size&&(o(),o=null)}}}}const V=function(e,n,c){const s=!Array.isArray(e),u=s?[e]:e,l=n.length<2;return J(c,(e=>{let c=!1;const a=[];let d=0,f=t;const p=()=>{if(d)return;f();const o=n(s?a[0]:a,e);l?e(o):f=r(o)?o:t},h=u.map(((t,e)=>i(t,(t=>{a[e]=t,d&=~(1<<e),c&&p()}),(()=>{d|=1<<e}))));return c=!0,p(),function(){o(h),f()}}))}(J(null,(t=>{G||window.navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}).then(t).catch((t=>console.error("Ooopsie woopsie",t)))})),((t,e)=>{null===t&&e(((t,e)=>e));const n=[],o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("playsinline",""),o.srcObject=t;const r=document.createElement("canvas"),c=r.getContext("2d");document.querySelector(".stream")?.appendChild(o);return o.addEventListener("play",(()=>{r.width=o.videoWidth,r.height=o.videoHeight;const t=setInterval((()=>{c?.drawImage(o,0,0,o.videoWidth,o.videoHeight)}),0);n.push((()=>clearInterval(t)))})),n.push((()=>o.remove())),n.push((()=>r.remove())),e(((t,e)=>{const n=(()=>{if(null===c)return[];try{return c.getImageData(0,0,o.videoWidth,o.videoHeight).data}catch(t){return[]}})();let r=e;for(let e=0;e<n.length;e+=4){r=t(r,[n[e+0],n[e+1],n[e+2]])}return r})),()=>{n.forEach((t=>t()))}})),X=K(!1),Y=K(null),Z=new T.Peer,tt=t=>{let e=0;for(const n of t)e+=n;return e},et=t=>{const e=(t=>{let e=0;const n=[];return{add:o=>{n.length<t?n.push(o):(n[e]=o,e++,e===n.length&&(e=0))},clear:()=>{n.splice(0),e=0},get:()=>n}})(t),n=K({mean:0,std:0});return{...n,addData:t=>{e.add(t),n.set((()=>{const t=e.get(),n=1/t.length,o=n*tt(t),r=n*Math.sqrt(tt(t.map((t=>Math.pow(t-o,2)))));return{mean:o,std:r}})())},clear:()=>{n.set({mean:0,std:0}),e.clear()},ready:()=>e.get().length===t}};function nt(e){let n,o;return{c(){n=d("div"),o=d("canvas"),m(n,"class","qr-code")},m(t,r){l(t,n,r),u(n,o),e[5](o)},p:t,i:t,o:t,d(t){t&&a(n),e[5](null)}}}function ot(t,e,n){let o,{padding:r=25}=e,{size:c=100}=e,{value:i="test data"}=e,s=null;return t.$$set=t=>{"padding"in t&&n(1,r=t.padding),"size"in t&&n(2,c=t.size),"value"in t&&n(3,i=t.value)},t.$$.update=()=>{1&t.$$.dirty&&n(4,o=null===s?null:new T.QRious({element:s})),30&t.$$.dirty&&o&&o.set({level:"M",padding:r,size:c,value:i})},[s,r,c,i,o,function(t){k[t?"unshift":"push"]((()=>{s=t,n(0,s)}))}]}class rt extends U{constructor(t){super(),Q(this,t,ot,nt,c,{padding:1,size:2,value:3})}}function ct(t){let e,n,r,c,i,s,$,v,b,w,y,x;return b=new rt({props:{value:t[0],size:.8*Math.min(window.innerWidth,window.innerHeight),padding:0}}),{c(){e=d("div"),n=d("button"),n.textContent="Ã—",r=p(),c=d("div"),i=d("p"),s=d("a"),$=f(t[0]),v=p(),W(b.$$.fragment),m(n,"class","close-button svelte-7w9va"),m(s,"href",t[0]),m(c,"class","join-info svelte-7w9va"),m(e,"class","join-info-scrim svelte-7w9va")},m(o,a){var d;l(o,e,a),u(e,n),u(e,r),u(e,c),u(c,i),u(i,s),u(s,$),u(c,v),q(b,c,null),w=!0,y||(x=[h(c,"click",(d=t[3],function(t){return t.stopPropagation(),d.call(this,t)})),h(e,"click",t[4])],y=!0)},p(t,[e]){(!w||1&e)&&g($,t[0]),(!w||1&e)&&m(s,"href",t[0]);const n={};1&e&&(n.value=t[0]),b.$set(n)},i(t){w||(N(b.$$.fragment,t),w=!0)},o(t){O(b.$$.fragment,t),w=!1},d(t){t&&a(e),H(b),y=!1,o(x)}}}function it(t,e,n){let o,{id:r=""}=e;const c=x();return t.$$set=t=>{"id"in t&&n(2,r=t.id)},t.$$.update=()=>{4&t.$$.dirty&&n(0,o=(t=>{const e=new URL(window.location.href);return e.searchParams.set("id",t),e.toString()})(r))},[o,c,r,function(e){_.call(this,t,e)},()=>c("close")]}class st extends U{constructor(t){super(),Q(this,t,it,ct,c,{id:2})}}function ut(t){let e,n;return e=new st({props:{id:t[3]}}),e.$on("close",t[8]),{c(){W(e.$$.fragment)},m(t,o){q(e,t,o),n=!0},p(t,n){const o={};8&n&&(o.id=t[3]),e.$set(o)},i(t){n||(N(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function lt(t){let e,n,o,r,c=Math.floor((t[2]-t[1])/1e3)+"";return{c(){e=d("p"),n=f("BANG! "),o=f(c),r=f("s")},m(t,c){l(t,e,c),u(e,n),u(e,o),u(e,r)},p(t,e){6&e&&c!==(c=Math.floor((t[2]-t[1])/1e3)+"")&&g(o,c)},d(t){t&&a(e)}}}function at(e){let n;return{c(){n=d("p"),n.textContent="Waiting for movement..."},m(t,e){l(t,n,e)},p:t,d(t){t&&a(n)}}}function dt(e){let n;return{c(){n=d("p"),n.textContent="Calibrating..."},m(t,e){l(t,n,e)},p:t,d(t){t&&a(n)}}}function ft(t){let e,n,r,c,i,s,f,g,v,b,w,y=null!==t[3]&&t[4]&&ut(t);function x(t,e){return t[0]?null===t[1]?at:lt:dt}let _=x(t),E=_(t);return{c(){e=d("main"),y&&y.c(),n=p(),r=d("div"),c=d("div"),i=d("button"),i.textContent="Connect Device",s=p(),f=d("button"),f.textContent="Reset Stats",g=p(),E.c(),m(c,"class","controls svelte-oag388"),m(r,"class","stats svelte-oag388"),$(r,"waiting",t[0]&&null===t[1]),$(r,"ready",t[0]&&null!==t[1]),m(e,"class","svelte-oag388")},m(o,a){l(o,e,a),y&&y.m(e,null),u(e,n),u(e,r),u(r,c),u(c,i),u(c,s),u(c,f),u(r,g),E.m(r,null),v=!0,b||(w=[h(i,"click",t[9]),h(f,"click",t[7])],b=!0)},p(t,[c]){null!==t[3]&&t[4]?y?(y.p(t,c),24&c&&N(y,1)):(y=ut(t),y.c(),N(y,1),y.m(e,n)):y&&(R={r:0,c:[],p:R},O(y,1,1,(()=>{y=null})),R.r||o(R.c),R=R.p),_===(_=x(t))&&E?E.p(t,c):(E.d(1),E=_(t),E&&(E.c(),E.m(r,null))),3&c&&$(r,"waiting",t[0]&&null===t[1]),3&c&&$(r,"ready",t[0]&&null!==t[1])},i(t){v||(N(y),v=!0)},o(t){O(y),v=!1},d(t){t&&a(e),y&&y.d(),E.d(),b=!1,o(w)}}}function pt(t,e,n){let o,r,c,i,u;s(t,V,(t=>n(13,c=t))),s(t,Y,(t=>n(3,i=t))),s(t,X,(t=>n(4,u=t)));const l=et(100);s(t,l,(t=>n(12,r=t)));const a=et(100);s(t,a,(t=>n(11,o=t)));let d=!1,f=null,p=Date.now(),h=Date.now();const m=()=>{l.clear(),a.clear(),n(1,f=null),p=Date.now()};y((()=>{const t=setInterval((()=>{const t=c(((t,e)=>t+e[0]+e[1]+e[2]),0),{mean:e}=r,{mean:i,std:s}=o,u=t-e,m=Math.ceil(Math.abs((u-i)/(s+10)));n(0,d=l.ready()),n(2,h=Date.now()),l.ready()?null===f&&Math.abs(m)>2&&(console.log("BANG",m,Date.now()),n(1,f=Date.now())):t>0&&h-p>3e3&&(l.addData(t),a.addData(u))}),10);return()=>{clearInterval(t),m()}})),y((()=>(Z.on("open",(t=>{Y.set(t)})),()=>{})));return[d,f,h,i,u,l,a,m,()=>X.set(!1),()=>X.set(!0)]}const ht=new class extends U{constructor(t){super(),Q(this,t,pt,ft,c,{})}}({target:document.body,props:{}});return"undefined"!=typeof module&&module.hot&&("undefined"!=typeof module&&module.hot.dispose((()=>{ht.$destroy()})),"undefined"!=typeof module&&module.hot.accept()),ht}();
//# sourceMappingURL=bundle.js.map
